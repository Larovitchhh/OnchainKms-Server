sudo tee /var/www/onchainkms/index.html > /dev/null << 'EOF'
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>ğŸ Ranking Mensual Strava</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: sans-serif; margin:20px; background:#f5f5f5; }
h1 { text-align:center; }
#status { text-align:center; margin-top:20px; }
table { border-collapse: collapse; width:80%; margin:20px auto; background:#fff; }
th, td { padding:10px; border:1px solid #ccc; text-align:left; }
canvas{ max-width:80%; margin:20px auto; display:block; }
</style>
</head>
<body>

<h1>ğŸ Ranking Mensual Strava</h1>
<p id="status">Cargando ranking...</p>

<table id="ranking" style="display:none;">
  <thead>
    <tr>
      <th>PosiciÃ³n</th>
      <th>Atleta</th>
      <th>Distancia (km)</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<canvas id="rankingChart" style="display:none;"></canvas>

<script>
(async () => {
  try {
    const response = await fetch('/api/ranking');
    const data = await response.json();
    const table = document.getElementById('ranking');
    const tbody = table.querySelector('tbody');

    if (data.ranking && data.ranking.length > 0) {
      tbody.innerHTML = '';
      const colores = ['#FFD700','#C0C0C0','#CD7F32','#3498db','#2980b9','#1abc9c','#16a085'];

      data.ranking.forEach((athlete, index) => {
        const tr = document.createElement('tr');
        let medalla = '';
        if(index===0) medalla='ğŸ¥‡';
        else if(index===1) medalla='ğŸ¥ˆ';
        else if(index===2) medalla='ğŸ¥‰';
        tr.innerHTML = `<td>${medalla} ${index+1}</td>
                        <td>${athlete.athlete}</td>
                        <td>${athlete.distance_km.toFixed(1)}</td>`;
        tbody.appendChild(tr);
      });

      table.style.display='';
      document.getElementById('status').style.display='none';

      const ctx = document.getElementById('rankingChart').getContext('2d');
      document.getElementById('rankingChart').style.display='';

      new Chart(ctx, {
        type:'bar',
        data: {
          labels: data.ranking.map(a=>a.athlete),
          datasets:[{label:'KilÃ³metros', data:data.ranking.map(a=>a.distance_km), backgroundColor: data.ranking.map((_,i)=>colores[i]||'#3498db')}]
        },
        options:{responsive:true, scales:{y:{beginAtZero:true}}}
      });
    } else {
      document.getElementById('status').textContent='No hay datos disponibles ğŸ˜¢';
    }
  } catch(err) {
    document.getElementById('status').textContent='Error al cargar el ranking ğŸ˜¢';
    console.error(err);
  }
})();
</script>

</body>
</html>
EOF
